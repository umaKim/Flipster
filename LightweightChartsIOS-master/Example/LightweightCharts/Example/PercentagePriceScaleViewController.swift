import UIKit
import LightweightCharts

class PercentagePriceScaleViewController: UIViewController {

    private var chart: LightweightCharts!
    private var areaSeries: AreaSeries!
    private var extraSeries: AreaSeries!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        if #available(iOS 13.0, *) {
            view.backgroundColor = .systemBackground
        } else {
            view.backgroundColor = .white
        }
        
        setupUI()
        setupData()
    }
    
    private func setupUI() {
        let options = ChartOptions(
            layout: LayoutOptions(background: .solid(color: "#100841"), textColor: "#ffffff"),
            rightPriceScale: VisiblePriceScaleOptions(mode: .percentage),
            timeScale: TimeScaleOptions(borderColor: "rgba(197, 203, 206, 0.4)"),
            grid: GridOptions(
                verticalLines: GridLineOptions(color: "rgba(197, 203, 206, 0.7)", style: .dotted),
                horizontalLines: GridLineOptions(color: "rgba(197, 203, 206, 0.7)", style: .dotted)
            )
        )
        let chart = LightweightCharts(options: options)
        view.addSubview(chart)
        chart.translatesAutoresizingMaskIntoConstraints = false
        if #available(iOS 11.0, *) {
            NSLayoutConstraint.activate([
                chart.leadingAnchor.constraint(equalTo: view.safeAreaLayoutGuide.leadingAnchor),
                chart.trailingAnchor.constraint(equalTo: view.safeAreaLayoutGuide.trailingAnchor),
                chart.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor),
                chart.bottomAnchor.constraint(equalTo: view.safeAreaLayoutGuide.bottomAnchor)
            ])
        } else {
            NSLayoutConstraint.activate([
                chart.leadingAnchor.constraint(equalTo: view.leadingAnchor),
                chart.trailingAnchor.constraint(equalTo: view.trailingAnchor),
                chart.topAnchor.constraint(equalTo: view.topAnchor),
                chart.bottomAnchor.constraint(equalTo: view.bottomAnchor)
            ])
        }
        self.chart = chart
    }
    
    private func setupData() {
        let areaSeriesOptions = AreaSeriesOptions(
            topColor: "rgba(67, 83, 254, 0.7)",
            bottomColor: "rgba(67, 83, 254, 0.3)",
            lineColor: "rgba(67, 83, 254, 1)",
            lineWidth: .two
        )
        let areaSeries = chart.addAreaSeries(options: areaSeriesOptions)
        let areaData = [
            AreaData(time: .string("2018-10-19"), value: 219.31),
            AreaData(time: .string("2018-10-22"), value: 220.65),
            AreaData(time: .string("2018-10-23"), value: 222.73),
            AreaData(time: .string("2018-10-24"), value: 215.09),
            AreaData(time: .string("2018-10-25"), value: 219.8),
            AreaData(time: .string("2018-10-26"), value: 216.3),
            AreaData(time: .string("2018-10-29"), value: 212.24),
            AreaData(time: .string("2018-10-30"), value: 213.3),
            AreaData(time: .string("2018-10-31"), value: 218.86),
            AreaData(time: .string("2018-11-01"), value: 222.22),
            AreaData(time: .string("2018-11-02"), value: 207.48),
            AreaData(time: .string("2018-11-05"), value: 201.59),
            AreaData(time: .string("2018-11-06"), value: 203.77),
            AreaData(time: .string("2018-11-07"), value: 209.95),
            AreaData(time: .string("2018-11-08"), value: 208.49),
            AreaData(time: .string("2018-11-09"), value: 204.47),
            AreaData(time: .string("2018-11-12"), value: 194.17),
            AreaData(time: .string("2018-11-13"), value: 192.23),
            AreaData(time: .string("2018-11-14"), value: 186.8),
            AreaData(time: .string("2018-11-15"), value: 191.41),
            AreaData(time: .string("2018-11-16"), value: 193.53),
            AreaData(time: .string("2018-11-19"), value: 185.86),
            AreaData(time: .string("2018-11-20"), value: 176.98),
            AreaData(time: .string("2018-11-21"), value: 176.78),
            AreaData(time: .string("2018-11-23"), value: 172.29),
            AreaData(time: .string("2018-11-26"), value: 174.62),
            AreaData(time: .string("2018-11-27"), value: 174.24),
            AreaData(time: .string("2018-11-28"), value: 180.94),
            AreaData(time: .string("2018-11-29"), value: 179.55),
            AreaData(time: .string("2018-11-30"), value: 178.58),
            AreaData(time: .string("2018-12-03"), value: 184.82),
            AreaData(time: .string("2018-12-04"), value: 176.69),
            AreaData(time: .string("2018-12-06"), value: 174.72),
            AreaData(time: .string("2018-12-07"), value: 168.49),
            AreaData(time: .string("2018-12-10"), value: 169.6),
            AreaData(time: .string("2018-12-11"), value: 168.63),
            AreaData(time: .string("2018-12-12"), value: 169.1),
            AreaData(time: .string("2018-12-13"), value: 170.95),
            AreaData(time: .string("2018-12-14"), value: 165.48),
            AreaData(time: .string("2018-12-17"), value: 163.94),
            AreaData(time: .string("2018-12-18"), value: 166.07),
            AreaData(time: .string("2018-12-19"), value: 160.89),
            AreaData(time: .string("2018-12-20"), value: 156.83),
            AreaData(time: .string("2018-12-21"), value: 150.73),
            AreaData(time: .string("2018-12-24"), value: 146.83),
            AreaData(time: .string("2018-12-26"), value: 157.17),
            AreaData(time: .string("2018-12-27"), value: 156.15),
            AreaData(time: .string("2018-12-28"), value: 156.23),
            AreaData(time: .string("2018-12-31"), value: 157.74),
            AreaData(time: .string("2019-01-02"), value: 157.92),
            AreaData(time: .string("2019-01-03"), value: 142.19),
            AreaData(time: .string("2019-01-04"), value: 148.26),
            AreaData(time: .string("2019-01-07"), value: 147.93),
            AreaData(time: .string("2019-01-08"), value: 150.75),
            AreaData(time: .string("2019-01-09"), value: 153.31),
            AreaData(time: .string("2019-01-10"), value: 153.8),
            AreaData(time: .string("2019-01-11"), value: 152.29),
            AreaData(time: .string("2019-01-14"), value: 150),
            AreaData(time: .string("2019-01-15"), value: 153.07),
            AreaData(time: .string("2019-01-16"), value: 154.94),
            AreaData(time: .string("2019-01-17"), value: 155.86),
            AreaData(time: .string("2019-01-18"), value: 156.82),
            AreaData(time: .string("2019-01-22"), value: 153.3),
            AreaData(time: .string("2019-01-23"), value: 153.92),
            AreaData(time: .string("2019-01-24"), value: 152.7),
            AreaData(time: .string("2019-01-25"), value: 157.76),
            AreaData(time: .string("2019-01-28"), value: 156.3),
            AreaData(time: .string("2019-01-29"), value: 154.68),
            AreaData(time: .string("2019-01-30"), value: 165.25),
            AreaData(time: .string("2019-01-31"), value: 166.44),
            AreaData(time: .string("2019-02-01"), value: 166.52),
            AreaData(time: .string("2019-02-04"), value: 171.25),
            AreaData(time: .string("2019-02-05"), value: 174.18),
            AreaData(time: .string("2019-02-06"), value: 174.24),
            AreaData(time: .string("2019-02-07"), value: 170.94),
            AreaData(time: .string("2019-02-08"), value: 170.41),
            AreaData(time: .string("2019-02-11"), value: 169.43),
            AreaData(time: .string("2019-02-12"), value: 170.89),
            AreaData(time: .string("2019-02-13"), value: 170.18),
            AreaData(time: .string("2019-02-14"), value: 170.8),
            AreaData(time: .string("2019-02-15"), value: 170.42),
            AreaData(time: .string("2019-02-19"), value: 170.93),
            AreaData(time: .string("2019-02-20"), value: 172.03),
            AreaData(time: .string("2019-02-21"), value: 171.06),
            AreaData(time: .string("2019-02-22"), value: 172.97),
            AreaData(time: .string("2019-02-25"), value: 174.23),
            AreaData(time: .string("2019-02-26"), value: 174.33),
            AreaData(time: .string("2019-02-27"), value: 174.87),
            AreaData(time: .string("2019-02-28"), value: 173.15),
            AreaData(time: .string("2019-03-01"), value: 174.97),
            AreaData(time: .string("2019-03-04"), value: 175.85),
            AreaData(time: .string("2019-03-05"), value: 175.53),
            AreaData(time: .string("2019-03-06"), value: 174.52),
            AreaData(time: .string("2019-03-07"), value: 172.5),
            AreaData(time: .string("2019-03-08"), value: 172.91),
            AreaData(time: .string("2019-03-11"), value: 178.9),
            AreaData(time: .string("2019-03-12"), value: 180.91),
            AreaData(time: .string("2019-03-13"), value: 181.71),
            AreaData(time: .string("2019-03-14"), value: 183.73),
            AreaData(time: .string("2019-03-15"), value: 186.12),
            AreaData(time: .string("2019-03-18"), value: 188.02),
            AreaData(time: .string("2019-03-19"), value: 186.53),
            AreaData(time: .string("2019-03-20"), value: 188.16),
            AreaData(time: .string("2019-03-21"), value: 195.09),
            AreaData(time: .string("2019-03-22"), value: 191.05),
            AreaData(time: .string("2019-03-25"), value: 188.74),
            AreaData(time: .string("2019-03-26"), value: 186.79),
            AreaData(time: .string("2019-03-27"), value: 188.47),
            AreaData(time: .string("2019-03-28"), value: 188.72),
            AreaData(time: .string("2019-03-29"), value: 189.95),
            AreaData(time: .string("2019-04-01"), value: 191.24),
            AreaData(time: .string("2019-04-02"), value: 194.02),
            AreaData(time: .string("2019-04-03"), value: 195.35),
            AreaData(time: .string("2019-04-04"), value: 195.69),
            AreaData(time: .string("2019-04-05"), value: 197),
            AreaData(time: .string("2019-04-08"), value: 200.1),
            AreaData(time: .string("2019-04-09"), value: 199.5),
            AreaData(time: .string("2019-04-10"), value: 200.62),
            AreaData(time: .string("2019-04-11"), value: 198.95),
            AreaData(time: .string("2019-04-12"), value: 198.87),
            AreaData(time: .string("2019-04-15"), value: 199.23),
            AreaData(time: .string("2019-04-16"), value: 199.25),
            AreaData(time: .string("2019-04-17"), value: 203.13),
            AreaData(time: .string("2019-04-18"), value: 203.86),
            AreaData(time: .string("2019-04-22"), value: 204.53),
            AreaData(time: .string("2019-04-23"), value: 207.48),
            AreaData(time: .string("2019-04-24"), value: 207.16),
            AreaData(time: .string("2019-04-25"), value: 205.28),
            AreaData(time: .string("2019-04-26"), value: 204.3),
            AreaData(time: .string("2019-04-29"), value: 204.61),
            AreaData(time: .string("2019-04-30"), value: 200.67),
            AreaData(time: .string("2019-05-01"), value: 210.52),
            AreaData(time: .string("2019-05-02"), value: 209.15),
            AreaData(time: .string("2019-05-03"), value: 211.75),
            AreaData(time: .string("2019-05-06"), value: 208.48),
            AreaData(time: .string("2019-05-07"), value: 202.86),
            AreaData(time: .string("2019-05-08"), value: 202.9),
            AreaData(time: .string("2019-05-09"), value: 200.72),
            AreaData(time: .string("2019-05-10"), value: 197.18),
            AreaData(time: .string("2019-05-13"), value: 185.72),
            AreaData(time: .string("2019-05-14"), value: 188.66),
            AreaData(time: .string("2019-05-15"), value: 190.92),
            AreaData(time: .string("2019-05-16"), value: 190.08),
            AreaData(time: .string("2019-05-17"), value: 189),
            AreaData(time: .string("2019-05-20"), value: 183.09),
            AreaData(time: .string("2019-05-21"), value: 186.6),
            AreaData(time: .string("2019-05-22"), value: 182.78),
            AreaData(time: .string("2019-05-23"), value: 179.66),
            AreaData(time: .string("2019-05-24"), value: 178.97),
            AreaData(time: .string("2019-05-28"), value: 179.07)
        ]
        areaSeries.setData(data: areaData)
        self.areaSeries = areaSeries
        
        let extraSeriesOptions = AreaSeriesOptions(
            topColor: "rgba(255, 192, 0, 0.7)",
            bottomColor: "rgba(255, 192, 0, 0.3)",
            lineColor: "rgba(255, 192, 0, 1)",
            lineWidth: .two
        )
        let extraSeries = chart.addAreaSeries(options: extraSeriesOptions)
        let extraData = [
            AreaData(time: .string("2018-10-19"), value: 44),
            AreaData(time: .string("2018-10-22"), value: 43.14),
            AreaData(time: .string("2018-10-23"), value: 42.3),
            AreaData(time: .string("2018-10-24"), value: 40.99),
            AreaData(time: .string("2018-10-25"), value: 41.59),
            AreaData(time: .string("2018-10-26"), value: 41.1),
            AreaData(time: .string("2018-10-29"), value: 41.03),
            AreaData(time: .string("2018-10-30"), value: 42.21),
            AreaData(time: .string("2018-10-31"), value: 43.37),
            AreaData(time: .string("2018-11-01"), value: 42.65),
            AreaData(time: .string("2018-11-02"), value: 41.6),
            AreaData(time: .string("2018-11-05"), value: 42.61),
            AreaData(time: .string("2018-11-06"), value: 42.66),
            AreaData(time: .string("2018-11-07"), value: 43.11),
            AreaData(time: .string("2018-11-08"), value: 41.27),
            AreaData(time: .string("2018-11-09"), value: 41.24),
            AreaData(time: .string("2018-11-12"), value: 40.87),
            AreaData(time: .string("2018-11-13"), value: 39.81),
            AreaData(time: .string("2018-11-14"), value: 40.33),
            AreaData(time: .string("2018-11-15"), value: 41.16),
            AreaData(time: .string("2018-11-16"), value: 40.84),
            AreaData(time: .string("2018-11-19"), value: 40.92),
            AreaData(time: .string("2018-11-20"), value: 40.1),
            AreaData(time: .string("2018-11-21"), value: 41.27),
            AreaData(time: .string("2018-11-23"), value: 39.89),
            AreaData(time: .string("2018-11-26"), value: 40.53),
            AreaData(time: .string("2018-11-27"), value: 40.32),
            AreaData(time: .string("2018-11-28"), value: 40.84),
            AreaData(time: .string("2018-11-29"), value: 40.48),
            AreaData(time: .string("2018-11-30"), value: 40.35),
            AreaData(time: .string("2018-12-03"), value: 41.19),
            AreaData(time: .string("2018-12-04"), value: 40.95),
            AreaData(time: .string("2018-12-06"), value: 39.59),
            AreaData(time: .string("2018-12-07"), value: 39.51),
            AreaData(time: .string("2018-12-10"), value: 39.37),
            AreaData(time: .string("2018-12-11"), value: 39.08),
            AreaData(time: .string("2018-12-12"), value: 39.05),
            AreaData(time: .string("2018-12-13"), value: 39.29),
            AreaData(time: .string("2018-12-14"), value: 38.66),
            AreaData(time: .string("2018-12-17"), value: 38.41),
            AreaData(time: .string("2018-12-18"), value: 37.82),
            AreaData(time: .string("2018-12-19"), value: 37.65),
            AreaData(time: .string("2018-12-20"), value: 37.26),
            AreaData(time: .string("2018-12-21"), value: 37.67),
            AreaData(time: .string("2018-12-24"), value: 36.65),
            AreaData(time: .string("2018-12-26"), value: 38.06),
            AreaData(time: .string("2018-12-27"), value: 37.73),
            AreaData(time: .string("2018-12-28"), value: 38.13),
            AreaData(time: .string("2018-12-31"), value: 37.92),
            AreaData(time: .string("2019-01-02"), value: 38.59),
            AreaData(time: .string("2019-01-03"), value: 38.81),
            AreaData(time: .string("2019-01-04"), value: 40.03),
            AreaData(time: .string("2019-01-07"), value: 40.16),
            AreaData(time: .string("2019-01-08"), value: 40.03),
            AreaData(time: .string("2019-01-09"), value: 40.36),
            AreaData(time: .string("2019-01-10"), value: 40.7),
            AreaData(time: .string("2019-01-11"), value: 40.24),
            AreaData(time: .string("2019-01-14"), value: 40.42),
            AreaData(time: .string("2019-01-15"), value: 40.24),
            AreaData(time: .string("2019-01-16"), value: 40.12),
            AreaData(time: .string("2019-01-17"), value: 40.13),
            AreaData(time: .string("2019-01-18"), value: 40.76),
            AreaData(time: .string("2019-01-22"), value: 40.08),
            AreaData(time: .string("2019-01-23"), value: 40.12),
            AreaData(time: .string("2019-01-24"), value: 40.11),
            AreaData(time: .string("2019-01-25"), value: 40.11),
            AreaData(time: .string("2019-01-28"), value: 39.57),
            AreaData(time: .string("2019-01-29"), value: 40.2),
            AreaData(time: .string("2019-01-30"), value: 40.67),
            AreaData(time: .string("2019-01-31"), value: 41.12),
            AreaData(time: .string("2019-02-01"), value: 41.34),
            AreaData(time: .string("2019-02-04"), value: 41.39),
            AreaData(time: .string("2019-02-05"), value: 42.82),
            AreaData(time: .string("2019-02-06"), value: 43.04),
            AreaData(time: .string("2019-02-07"), value: 42.7),
            AreaData(time: .string("2019-02-08"), value: 42.49),
            AreaData(time: .string("2019-02-11"), value: 42.21),
            AreaData(time: .string("2019-02-12"), value: 42.42),
            AreaData(time: .string("2019-02-13"), value: 42.64),
            AreaData(time: .string("2019-02-14"), value: 41.87),
            AreaData(time: .string("2019-02-15"), value: 42.29),
            AreaData(time: .string("2019-02-19"), value: 42.38),
            AreaData(time: .string("2019-02-20"), value: 42.48),
            AreaData(time: .string("2019-02-21"), value: 42.29),
            AreaData(time: .string("2019-02-22"), value: 42.46),
            AreaData(time: .string("2019-02-25"), value: 42.51),
            AreaData(time: .string("2019-02-26"), value: 42.52),
            AreaData(time: .string("2019-02-27"), value: 42.84),
            AreaData(time: .string("2019-02-28"), value: 42.65),
            AreaData(time: .string("2019-03-01"), value: 42.58),
            AreaData(time: .string("2019-03-04"), value: 42.64),
            AreaData(time: .string("2019-03-05"), value: 42.74),
            AreaData(time: .string("2019-03-06"), value: 42.7),
            AreaData(time: .string("2019-03-07"), value: 42.63),
            AreaData(time: .string("2019-03-08"), value: 42.25),
            AreaData(time: .string("2019-03-11"), value: 42.33),
            AreaData(time: .string("2019-03-12"), value: 42.46),
            AreaData(time: .string("2019-03-13"), value: 43.83),
            AreaData(time: .string("2019-03-14"), value: 43.95),
            AreaData(time: .string("2019-03-15"), value: 43.87),
            AreaData(time: .string("2019-03-18"), value: 44.24),
            AreaData(time: .string("2019-03-19"), value: 44.47),
            AreaData(time: .string("2019-03-20"), value: 44.53),
            AreaData(time: .string("2019-03-21"), value: 44.53),
            AreaData(time: .string("2019-03-22"), value: 43.95),
            AreaData(time: .string("2019-03-25"), value: 43.53),
            AreaData(time: .string("2019-03-26"), value: 43.82),
            AreaData(time: .string("2019-03-27"), value: 43.59),
            AreaData(time: .string("2019-03-28"), value: 43.63),
            AreaData(time: .string("2019-03-29"), value: 43.72),
            AreaData(time: .string("2019-04-01"), value: 44.09),
            AreaData(time: .string("2019-04-02"), value: 44.23),
            AreaData(time: .string("2019-04-03"), value: 44.23),
            AreaData(time: .string("2019-04-04"), value: 44.15),
            AreaData(time: .string("2019-04-05"), value: 44.53),
            AreaData(time: .string("2019-04-08"), value: 45.23),
            AreaData(time: .string("2019-04-09"), value: 44.99),
            AreaData(time: .string("2019-04-10"), value: 45.04),
            AreaData(time: .string("2019-04-11"), value: 44.87),
            AreaData(time: .string("2019-04-12"), value: 44.67),
            AreaData(time: .string("2019-04-15"), value: 44.67),
            AreaData(time: .string("2019-04-16"), value: 44.48),
            AreaData(time: .string("2019-04-17"), value: 44.62),
            AreaData(time: .string("2019-04-18"), value: 44.39),
            AreaData(time: .string("2019-04-22"), value: 45.04),
            AreaData(time: .string("2019-04-23"), value: 45.02),
            AreaData(time: .string("2019-04-24"), value: 44.13),
            AreaData(time: .string("2019-04-25"), value: 43.96),
            AreaData(time: .string("2019-04-26"), value: 43.31),
            AreaData(time: .string("2019-04-29"), value: 43.02),
            AreaData(time: .string("2019-04-30"), value: 43.73),
            AreaData(time: .string("2019-05-01"), value: 43.08),
            AreaData(time: .string("2019-05-02"), value: 42.63),
            AreaData(time: .string("2019-05-03"), value: 43.08),
            AreaData(time: .string("2019-05-06"), value: 42.93),
            AreaData(time: .string("2019-05-07"), value: 42.22),
            AreaData(time: .string("2019-05-08"), value: 42.28),
            AreaData(time: .string("2019-05-09"), value: 41.65),
            AreaData(time: .string("2019-05-10"), value: 41.5),
            AreaData(time: .string("2019-05-13"), value: 41.23),
            AreaData(time: .string("2019-05-14"), value: 41.55),
            AreaData(time: .string("2019-05-15"), value: 41.77),
            AreaData(time: .string("2019-05-16"), value: 42.28),
            AreaData(time: .string("2019-05-17"), value: 42.34),
            AreaData(time: .string("2019-05-20"), value: 42.58),
            AreaData(time: .string("2019-05-21"), value: 42.75),
            AreaData(time: .string("2019-05-22"), value: 42.34),
            AreaData(time: .string("2019-05-23"), value: 41.34),
            AreaData(time: .string("2019-05-24"), value: 41.76),
            AreaData(time: .string("2019-05-28"), value: 41.625)
        ]
        extraSeries.setData(data: extraData)
        self.extraSeries = extraSeries
    }

}
